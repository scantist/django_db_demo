from django_db_demo.model.models import Vulnerability, Component
from django.core.exceptions import ObjectDoesNotExist
from django.utils import timezone


def insert_vulnerability(name, public_id, component, description=''):
    vulnerability = Vulnerability(name=name, public_id=public_id, description=description, created=timezone.now(),
                                  component_id_fk=component)
    vulnerability.save()


''' return components of the subject in database '''
def query_vulnerability_by_component(component_id):
    component = Component.objects.get(component_id=component_id)
    vulnerabilities = component.vulnerability_set.all()
    return vulnerabilities


def has_same_vulnerability_name(name):
    try:
        Vulnerability.objects.get(name=name)
        return True
    except ObjectDoesNotExist:
        return False


def has_same_vulnerability_public_id(public_id, vulnerability_id=-1):
    try:
        vulnerability = Vulnerability.objects.get(public_id=public_id)

        if vulnerability.vulnerability_id == vulnerability_id:
            return False
        else:
            return True
    except ObjectDoesNotExist:
        return False


def delete_vulnerability_by_id(vulnerability_id):
    vulnerability = Vulnerability.objects.get(vulnerability_id=vulnerability_id)
    vulnerability.delete()
